---
import exifr from 'exifr'
// @ts-ignore 
import Lightbox from 'astro-travelens/lightbox'

export interface Props {
  folder: string
}

const { folder } = Astro.props

const imageFiles = import.meta.glob<ImageMetadata>('../assets/gallery/**/*.{png,webp,jpg,jpeg}', { import: 'default', eager: true })
const folderFiles = Object.keys(imageFiles).filter(image => image.search(folder) >= 0)
const exifs = [] as Record<string, any>[]
for (let i in folderFiles) {
  const exif = await exifr.parse(folderFiles[i].replace('../', './src/'))
  exifs.push(exif)
}
const images = folderFiles.map((image, i) => {
  return {
    file: image,
    title: image.slice(0, image.lastIndexOf('.')).slice(image.lastIndexOf('/') + 1),
    image: imageFiles[image],
    exif: exifs[i]
  }
}).sort((a, b) => {
    return a.exif.CreateDate - b.exif.CreateDate;
})

const gallery = 'gallery-' + folder
---
<p class="text-sm text-neutral-500 italic sm:px-2 lg:px-4">Please click on any photo to view in a lightbox. Use arrow keys or swipe to navigate.</p>
<div id={gallery} class="w-full block mx-auto columns-1 gap-2 lg:gap-4 mx-auto px-2 lg:px-4 sm:columns-2 lg:columns-3 not-prose" itemscope itemtype="http://schema.org/ImageGallery">
  <Lightbox id={gallery} images={images} />
</div>
