---
import type { CollectionEntry } from 'astro:content'
import { getCollection } from 'astro:content'
import { Image } from 'astro:assets'
// @ts-ignore 
import Map from 'astro-travelens/map'
import Post from '../layouts/Post.astro'
import Gallery from '../components/Gallery.astro'
import TripImage from '../assets/trip.jpeg'

// 1. Generate a new path for every collection entry
export async function getStaticPaths() {
  const posts = await getCollection('post', ({ data }) => {
  return data.draft !== true;
})
  return posts
    .sort((a, b) => +a.data.date - +b.data.date)
    .map((post, i) => ({
      params: { slug: post.slug },
      props: {
        post,
        prev: i > 0 ? posts[i - 1] : undefined,
        next: i < posts.length - 1 ? posts[i + 1] : undefined,
      },
  }))
}

// 2. When it's time to render, you can get the entry directly from the prop
export interface Props {
  post: CollectionEntry<'post'>
  prev?: CollectionEntry<'post'>
  next?: CollectionEntry<'post'>
}
const { post, prev, next } = Astro.props
const { Content } = await post.render()
---

<Post post={post}>
  <div
    class="max-w-4xl mx-auto bg-white pb-6 mb-6 px-12 lg:px-24 relative z-10"
  >
    <div class="prose prose-sm sm:prose lg:prose-lg pt-6">
      <Content />
    </div>
  </div>
  {post.data.gallery && <Gallery folder={post.data.gallery} />}
  {post.data.map && <Map text={post.data.location} lat={post.data.map[0]} lng={post.data.map[1]} zoom={post.data.map[2]}/>}
  <div class="grid grid-cols-1 md:grid-cols-3 bg-neutral-200 py-12">
    {
      prev ? (
        <a
          href={import.meta.env.BASE_URL + prev.slug}
          class="bg-black relative block flex items-center justify-center h-72 font-heading text-white uppercase tracking-widest hover:opacity-75"
        >
          <div class="relative z-10">Previous: {prev.data.title}</div>
          <Image
            src={prev.data.image}
            width={1024}
            class="absolute inset-0 w-full h-full object-cover opacity-50"
            alt={prev.data.title}
          />
        </a>
      ) : (
        <div />
      )
    }
    <a
      href={import.meta.env.BASE_URL}
      class="bg-black relative block flex items-center justify-center h-72 font-heading text-white uppercase tracking-widest hover:opacity-75"
    >
      <div class="relative z-10">Back to Trip: {post.data.trip}</div>
      <Image
        src={TripImage}
        width={1024}
        class="absolute inset-0 w-full h-full object-cover opacity-50"
        alt={post.data.trip}
      />
    </a>
    {
      next ? (
        <a
          href={import.meta.env.BASE_URL + next.slug}
          class="bg-black relative block flex items-center justify-center h-72 font-heading text-white uppercase tracking-widest hover:opacity-75"
        >
          <div class="relative z-10">Next: {next.data.title}</div>
          <Image
            src={next.data.image}
            width={1024}
            class="absolute inset-0 w-full h-full object-cover opacity-50"
            alt={next.data.title}
          />
        </a>
      ) : (
        <div />
      )
    }
  </div>
</Post>
